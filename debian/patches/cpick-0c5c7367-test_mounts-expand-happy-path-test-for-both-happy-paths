From 0c5c736727d0f8e363678fe970d70bb889e3893c Mon Sep 17 00:00:00 2001
From: Daniel Watkins <oddbloke@ubuntu.com>
Date: Thu, 16 Apr 2020 11:18:36 -0400
Subject: [PATCH] test_mounts: expand happy path test for both happy paths
 (#319)

---
 cloudinit/config/tests/test_mounts.py | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

--- a/cloudinit/config/tests/test_mounts.py
+++ b/cloudinit/config/tests/test_mounts.py
@@ -1,6 +1,8 @@
 # This file is part of cloud-init. See LICENSE file for license information.
 from unittest import mock
 
+import pytest
+
 from cloudinit.config.cc_mounts import create_swapfile
 
 
@@ -9,8 +11,10 @@ M_PATH = 'cloudinit.config.cc_mounts.'
 
 class TestCreateSwapfile:
 
+    @pytest.mark.parametrize('fstype', ('xfs', 'btrfs', 'ext4', 'other'))
+    @mock.patch(M_PATH + 'util.get_mount_info')
     @mock.patch(M_PATH + 'util.subp')
-    def test_happy_path(self, m_subp, tmpdir):
+    def test_happy_path(self, m_subp, m_get_mount_info, fstype, tmpdir):
         swap_file = tmpdir.join("swap-file")
         fname = str(swap_file)
 
@@ -18,5 +22,7 @@ class TestCreateSwapfile:
         # roughly approximates that
         m_subp.side_effect = lambda *args, **kwargs: swap_file.write('')
 
+        m_get_mount_info.return_value = (mock.ANY, fstype)
+
         create_swapfile(fname, '')
         assert mock.call(['mkswap', fname]) in m_subp.call_args_list
